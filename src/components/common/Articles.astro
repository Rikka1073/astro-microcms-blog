---
import Card from "../Card.astro";
import Filter from "../Filter.astro";

type Categories = {
  name: string;
  tags: string;
};

const accessToken = import.meta.env.QIITA_API_ACCESS_TOKEN;
const response = await fetch(`https://qiita.com/api/v2/authenticated_user/items?page=1&per_page=20`, {
  headers: {
    Authorization: `Bearer ${accessToken}`,
  },
});
const articles = await response.json();
console.log("記事データ", articles);

const categories = [...new Set(articles.flatMap((article: Categories) => article.tags).map((tag: Categories) => tag.name))];
console.log("カテゴリ", categories);
---

<Filter categories={categories} />
<div class="sm:grid sm:grid-cols-2 md:grid-cols-3 sm:gap-5 lg:grid-cols-4">
  {articles.map((article: any) => <Card title={article.title} tags={article.tags} url={article.url} />)}
</div>
